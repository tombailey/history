"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var resolvePathname=_interopDefault(require("resolve-pathname")),valueEqual=_interopDefault(require("value-equal"));require("tiny-warning");var invariant=_interopDefault(require("tiny-invariant"));function _extends(){return(_extends=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function addLeadingSlash(t){return"/"===t.charAt(0)?t:"/"+t}function stripLeadingSlash(t){return"/"===t.charAt(0)?t.substr(1):t}function hasBasename(t,n){return 0===t.toLowerCase().indexOf(n.toLowerCase())&&-1!=="/?#".indexOf(t.charAt(n.length))}function stripBasename(t,n){return hasBasename(t,n)?t.substr(n.length):t}function stripTrailingSlash(t){return"/"===t.charAt(t.length-1)?t.slice(0,-1):t}function parsePath(t){var n=t||"/",e="",a="",r=n.indexOf("#");-1!==r&&(a=n.substr(r),n=n.substr(0,r));var o=n.indexOf("?");return-1!==o&&(e=n.substr(o),n=n.substr(0,o)),{pathname:n,search:"?"===e?"":e,hash:"#"===a?"":a}}function createPath(t){var n=t.pathname,e=t.search,a=t.hash,r=n||"/";return e&&"?"!==e&&(r+="?"===e.charAt(0)?e:"?"+e),a&&"#"!==a&&(r+="#"===a.charAt(0)?a:"#"+a),r}function createLocation(t,n,e,a){var r;"string"==typeof t?(r=parsePath(t)).state=n:(void 0===(r=_extends({},t)).pathname&&(r.pathname=""),r.search?"?"!==r.search.charAt(0)&&(r.search="?"+r.search):r.search="",r.hash?"#"!==r.hash.charAt(0)&&(r.hash="#"+r.hash):r.hash="",void 0!==n&&void 0===r.state&&(r.state=n));try{r.pathname=decodeURI(r.pathname)}catch(t){throw t instanceof URIError?new URIError('Pathname "'+r.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):t}return e&&(r.key=e),a?r.pathname?"/"!==r.pathname.charAt(0)&&(r.pathname=resolvePathname(r.pathname,a.pathname)):r.pathname=a.pathname:r.pathname||(r.pathname="/"),r}function locationsAreEqual(t,n){return t.pathname===n.pathname&&t.search===n.search&&t.hash===n.hash&&t.key===n.key&&valueEqual(t.state,n.state)}function createTransitionManager(){var o=null;var a=[];return{setPrompt:function(t){return o=t,function(){o===t&&(o=null)}},confirmTransitionTo:function(t,n,e,a){if(null!=o){var r="function"==typeof o?o(t,n):o;"string"==typeof r?"function"==typeof e?e(r,a):a(!0):a(!1!==r)}else a(!0)},appendListener:function(t){var n=!0;function e(){n&&t.apply(void 0,arguments)}return a.push(e),function(){n=!1,a=a.filter(function(t){return t!==e})}},notifyListeners:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];a.forEach(function(t){return t.apply(void 0,n)})}}}var canUseDOM=!("undefined"==typeof window||!window.document||!window.document.createElement);function getConfirmation(t,n){n(window.confirm(t))}function supportsHistory(){var t=window.navigator.userAgent;return(-1===t.indexOf("Android 2.")&&-1===t.indexOf("Android 4.0")||-1===t.indexOf("Mobile Safari")||-1!==t.indexOf("Chrome")||-1!==t.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function supportsPopStateOnHashChange(){return-1===window.navigator.userAgent.indexOf("Trident")}function supportsGoWithoutReloadUsingHash(){return-1===window.navigator.userAgent.indexOf("Firefox")}function isExtraneousPopstateEvent(t){return void 0===t.state&&-1===navigator.userAgent.indexOf("CriOS")}var PopStateEvent="popstate",HashChangeEvent="hashchange";function getHistoryState(){try{return window.history.state||{}}catch(t){return{}}}function createBrowserHistory(t){void 0===t&&(t={}),canUseDOM||invariant(!1);var s=window.history,c=supportsHistory(),n=!supportsPopStateOnHashChange(),e=t.forceRefresh,h=void 0!==e&&e,a=t.getUserConfirmation,r=void 0===a?getConfirmation:a,o=t.keyLength,i=void 0===o?6:o,u=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"";function f(t){var n=t||{},e=n.key,a=n.state,r=window.location,o=r.pathname+r.search+r.hash;return u&&(o=stripBasename(o,u)),createLocation(o,a,e)}function l(){return Math.random().toString(36).substr(2,i)}var d=createTransitionManager();function v(t){_extends(S,t),S.length=s.length,d.notifyListeners(S.location,S.action)}function p(t){isExtraneousPopstateEvent(t)||m(f(t.state))}function g(){m(f(getHistoryState()))}var P=!1;function m(n){if(P)P=!1,v();else{d.confirmTransitionTo(n,"POP",r,function(t){t?v({action:"POP",location:n}):function(t){var n=S.location,e=y.indexOf(n.key);-1===e&&(e=0);var a=y.indexOf(t.key);-1===a&&(a=0);var r=e-a;r&&(P=!0,x(r))}(n)})}}var w=f(getHistoryState()),y=[w.key];function H(t){return u+createPath(t)}function x(t){s.go(t)}var L=0;function O(t){1===(L+=t)&&1===t?(window.addEventListener(PopStateEvent,p),n&&window.addEventListener(HashChangeEvent,g)):0===L&&(window.removeEventListener(PopStateEvent,p),n&&window.removeEventListener(HashChangeEvent,g))}var E=!1;var S={length:s.length,action:"POP",location:w,createHref:H,push:function(t,n){var i=createLocation(t,n,l(),S.location);d.confirmTransitionTo(i,"PUSH",r,function(t){if(t){var n=H(i),e=i.key,a=i.state;if(c)if(s.pushState({key:e,state:a},null,n),h)window.location.href=n;else{var r=y.indexOf(S.location.key),o=y.slice(0,r+1);o.push(i.key),y=o,v({action:"PUSH",location:i})}else window.location.href=n}})},replace:function(t,n){var o="REPLACE",i=createLocation(t,n,l(),S.location);d.confirmTransitionTo(i,o,r,function(t){if(t){var n=H(i),e=i.key,a=i.state;if(c)if(s.replaceState({key:e,state:a},null,n),h)window.location.replace(n);else{var r=y.indexOf(S.location.key);-1!==r&&(y[r]=i.key),v({action:o,location:i})}else window.location.replace(n)}})},go:x,goBack:function(){x(-1)},goForward:function(){x(1)},block:function(t){void 0===t&&(t=!1);var n=d.setPrompt(t);return E||(O(1),E=!0),function(){return E&&(E=!1,O(-1)),n()}},listen:function(t){var n=d.appendListener(t);return O(1),function(){O(-1),n()}}};return S}var HashChangeEvent$1="hashchange",HashPathCoders={hashbang:{encodePath:function(t){return"!"===t.charAt(0)?t:"!/"+stripLeadingSlash(t)},decodePath:function(t){return"!"===t.charAt(0)?t.substr(1):t}},noslash:{encodePath:stripLeadingSlash,decodePath:addLeadingSlash},slash:{encodePath:addLeadingSlash,decodePath:addLeadingSlash}};function stripHash(t){var n=t.indexOf("#");return-1===n?t:t.slice(0,n)}function getHashPath(){var t=window.location.href,n=t.indexOf("#");return-1===n?"":t.substring(n+1)}function pushHashPath(t){window.location.hash=t}function replaceHashPath(t){window.location.replace(stripHash(window.location.href)+"#"+t)}function createHashHistory(t){void 0===t&&(t={}),canUseDOM||invariant(!1);var n=window.history,e=(supportsGoWithoutReloadUsingHash(),t.getUserConfirmation),i=void 0===e?getConfirmation:e,a=t.hashType,r=void 0===a?"slash":a,s=t.basename?stripTrailingSlash(addLeadingSlash(t.basename)):"",o=HashPathCoders[r],c=o.encodePath,h=o.decodePath;function u(){var t=h(getHashPath());return s&&(t=stripBasename(t,s)),createLocation(t)}var f=createTransitionManager();function l(t){_extends(O,t),O.length=n.length,f.notifyListeners(O.location,O.action)}var d=!1,v=null;function p(){var t,n,e=getHashPath(),a=c(e);if(e!==a)replaceHashPath(a);else{var r=u(),o=O.location;if(!d&&(n=r,(t=o).pathname===n.pathname&&t.search===n.search&&t.hash===n.hash))return;if(v===createPath(r))return;v=null,function(n){if(d)d=!1,l();else{f.confirmTransitionTo(n,"POP",i,function(t){t?l({action:"POP",location:n}):function(t){var n=O.location,e=w.lastIndexOf(createPath(n));-1===e&&(e=0);var a=w.lastIndexOf(createPath(t));-1===a&&(a=0);var r=e-a;r&&(d=!0,y(r))}(n)})}}(r)}}var g=getHashPath(),P=c(g);g!==P&&replaceHashPath(P);var m=u(),w=[createPath(m)];function y(t){n.go(t)}var H=0;function x(t){1===(H+=t)&&1===t?window.addEventListener(HashChangeEvent$1,p):0===H&&window.removeEventListener(HashChangeEvent$1,p)}var L=!1;var O={length:n.length,action:"POP",location:m,createHref:function(t){var n=document.querySelector("base"),e="";return n&&n.getAttribute("href")&&(e=stripHash(window.location.href)),e+"#"+c(s+createPath(t))},push:function(t,n){var o=createLocation(t,void 0,void 0,O.location);f.confirmTransitionTo(o,"PUSH",i,function(t){if(t){var n=createPath(o),e=c(s+n);if(getHashPath()!==e){v=n,pushHashPath(e);var a=w.lastIndexOf(createPath(O.location)),r=w.slice(0,a+1);r.push(n),w=r,l({action:"PUSH",location:o})}else l()}})},replace:function(t,n){var r="REPLACE",o=createLocation(t,void 0,void 0,O.location);f.confirmTransitionTo(o,r,i,function(t){if(t){var n=createPath(o),e=c(s+n);getHashPath()!==e&&(v=n,replaceHashPath(e));var a=w.indexOf(createPath(O.location));-1!==a&&(w[a]=n),l({action:r,location:o})}})},go:y,goBack:function(){y(-1)},goForward:function(){y(1)},block:function(t){void 0===t&&(t=!1);var n=f.setPrompt(t);return L||(x(1),L=!0),function(){return L&&(L=!1,x(-1)),n()}},listen:function(t){var n=f.appendListener(t);return x(1),function(){x(-1),n()}}};return O}function clamp(t,n,e){return Math.min(Math.max(t,n),e)}function createMemoryHistory(t){void 0===t&&(t={});var r=t.getUserConfirmation,n=t.initialEntries,e=void 0===n?["/"]:n,a=t.initialIndex,o=void 0===a?0:a,i=t.keyLength,s=void 0===i?6:i,c=createTransitionManager();function h(t){_extends(p,t),p.length=p.entries.length,c.notifyListeners(p.location,p.action)}function u(){return Math.random().toString(36).substr(2,s)}var f=clamp(o,0,e.length-1),l=e.map(function(t){return createLocation(t,void 0,"string"==typeof t?u():t.key||u())}),d=createPath;function v(t){var n=clamp(p.index+t,0,p.entries.length-1),e=p.entries[n];c.confirmTransitionTo(e,"POP",r,function(t){t?h({action:"POP",location:e,index:n}):h()})}var p={length:l.length,action:"POP",location:l[f],index:f,entries:l,createHref:d,push:function(t,n){if(void 0!==t){var a=createLocation(t,n,u(),p.location);c.confirmTransitionTo(a,"PUSH",r,function(t){if(t){var n=p.index+1,e=p.entries.slice(0);e.length>n?e.splice(n,e.length-n,a):e.push(a),h({action:"PUSH",location:a,index:n,entries:e})}})}},replace:function(t,n){var e="REPLACE",a=createLocation(t,n,u(),p.location);c.confirmTransitionTo(a,e,r,function(t){t&&(p.entries[p.index]=a,h({action:e,location:a}))})},go:v,goBack:function(){v(-1)},goForward:function(){v(1)},canGo:function(t){var n=p.index+t;return 0<=n&&n<p.entries.length},block:function(t){return void 0===t&&(t=!1),c.setPrompt(t)},listen:function(t){return c.appendListener(t)}};return p}exports.createBrowserHistory=createBrowserHistory,exports.createHashHistory=createHashHistory,exports.createMemoryHistory=createMemoryHistory,exports.createLocation=createLocation,exports.locationsAreEqual=locationsAreEqual,exports.parsePath=parsePath,exports.createPath=createPath;
